generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "postgresql"
}

// --- ENUMS ---

enum Availability {
  AVAILABLE
  BUSY
  OPEN_FOR_COMMISSION
}

enum MessageStatus {
  UNREAD
  READ
  ARCHIVED
  SPAM
}

enum ProjectCategory {
  WEB_DEVELOPMENT
  MOBILE_APP
  UI_UX_DESIGN
  GRAPHIC_DESIGN
  DATA_SCIENCE
  AI
  OPEN_SOURCE
  OTHERS
}

// -----------------------------------------
// 1. IDENTITY & PROFILE
// -----------------------------------------
// --- ENUMS ---

enum UserRole {
  SUPER_ADMIN
  ADMIN
  USER
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  password      String? // Hashed (for Credentials login)
  image         String?
  role          UserRole  @default(USER)

  // Auth Relations
  accounts Account[]
  sessions Session[]

  // Portfolio Relations
  profile Profile?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// -----------------------------------------
// 2. PROFILE & CONTACT (The "Who I Am")
// -----------------------------------------

model Profile {
  id     String @id @default("owner-static")
  userId String @unique
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  professionalEmail String       @default("contact@example.com")
  location          String?      @default("Remote / Yemen")
  availability      Availability @default(AVAILABLE)

  socials   ContactMe?
  updatedAt DateTime   @updatedAt
}

model ContactMe {
  id        String  @id @default(cuid())
  profileId String  @unique
  profile   Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  githubUrl   String?
  linkedinUrl String?
  xUrl        String?
  facebookUrl String?
  instaUrl    String?
  whatsapp    String?
  figma       String?

  updatedAt DateTime @updatedAt
}

// -----------------------------------------
// 2. CONTACT MESSAGES & TESTIMONIALS
// -----------------------------------------
model ContactMessage {
  id        String        @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String        @db.Text
  status    MessageStatus @default(UNREAD)
  ipAddress String? // Anti-spam tracking
  createdAt DateTime      @default(now())
}

model Testimonial {
  id          String   @id @default(cuid())
  clientName  String
  clientTitle String // e.g. "Founder"
  role        String? // e.g. "CEO at TechCorp"
  content     String   @db.Text
  rating      Int?     @default(5)
  email       String? // Added the missing field
  avatarUrl   String? // Mapped to "src" in the UI
  linkedinUrl String?
  isFeatured  Boolean  @default(false)
  isActive    Boolean  @default(false) // Admin must approve before showing
  createdAt   DateTime @default(now())

  @@index([isActive, isFeatured])
}

// -----------------------------------------
// 3. UI STATE CONTROL (Global Toggles)
// -----------------------------------------
model SectionActive {
  id                  String  @id @default("ui-config")
  heroActive          Boolean @default(true)
  aboutActive         Boolean @default(true)
  projectActive       Boolean @default(true)
  blogActive          Boolean @default(true)
  skillActive         Boolean @default(true)
  certificationActive Boolean @default(true)
  experienceActive    Boolean @default(true)
  educationActive     Boolean @default(true)
  contactActive       Boolean @default(true)
  testiActive         Boolean @default(true)
}

// -----------------------------------------
// 2. HERO & ABOUT
// -----------------------------------------

model HeroSection {
  id              String       @id @default("hero-static")
  status          Availability @default(AVAILABLE)
  greeting        String       @default("Hi, I am")
  name            String       @default("Mohammed Yaseen")
  role            String       @default("Full-Stack Developer & AI Researcher")
  description     String       @db.Text
  primaryImage    String
  secondaryImages String[]
  resumeUrl       String?
  ctaText         String       @default("Start a Project")
  updatedAt       DateTime     @updatedAt
}

model AboutSection {
  id          String        @id @default("about-static")
  title       String        @default("A Hybrid Approach to Problem Solving")
  subtitle    String        @default("My background in Security Research...")
  description String        @db.Text
  corePillars CorePillar[]
  statuses    AboutStatus[]
  updatedAt   DateTime      @updatedAt
}

model AboutStatus {
  id             String       @id @default(cuid())
  label          String
  value          String
  isActive       Boolean      @default(true)
  aboutSectionId String
  aboutSection   AboutSection @relation(fields: [aboutSectionId], references: [id], onDelete: Cascade)
}

model CorePillar {
  id             String       @id @default(cuid())
  title          String
  description    String       @db.Text
  icon           String
  aboutSectionId String
  aboutSection   AboutSection @relation(fields: [aboutSectionId], references: [id], onDelete: Cascade)
}

// -----------------------------------------
// 3. BLOG SYSTEM (Enhanced)
// -----------------------------------------

model Blog {
  id          String   @id @default(cuid())
  title       String
  slug        String   @unique
  category    String   @default("General")
  excerpt     String   @db.Text
  content     String   @db.Text
  image       String // Featured Image
  gallery     String[] // Additional images inside post
  readTime    String?  @default("5 min")
  isPublished Boolean  @default(false)

  tags     Tag[] // Relation to Tags
  likes    Like[]
  comments Comment[]

  publishedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
}

model Tag {
  id       String    @id @default(cuid())
  name     String    @unique
  blogs    Blog[]
  projects Project[]
}

model Like {
  id     String  @id @default(cuid())
  blogId String
  blog   Blog    @relation(fields: [blogId], references: [id], onDelete: Cascade)
  ip     String? // Track unique likes without auth
}

model Comment {
  id        String   @id @default(cuid())
  name      String
  content   String   @db.Text
  blogId    String
  blog      Blog     @relation(fields: [blogId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

// -----------------------------------------
// 4. WORK & EXPERIENCE
// -----------------------------------------

model Project {
  id          String          @id @default(cuid())
  title       String
  slug        String          @unique
  description String          @db.Text
  content     String?         @db.Text
  image       String
  gallery     String[]
  category    ProjectCategory @default(WEB_DEVELOPMENT)
  liveUrl     String?
  repoUrl     String?
  isFeatured  Boolean         @default(false)
  isActive    Boolean         @default(true)
  isPublished Boolean         @default(true)

  techniques Technique[]
  tags       Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
}

// model ExperienceStatuse {
//   PRESENT

// }
model Experience {
  id          String      @id @default(cuid())
  companyName String
  role        String
  // status 
  location    String?
  startDate   DateTime
  endDate     DateTime? // Null = Present
  description String?     @db.Text
  techniques  Technique[]
  updatedAt   DateTime    @updatedAt
}

model Education {
  id           String    @id @default(cuid())
  institution  String
  degree       String
  fieldOfStudy String
  startDate    DateTime
  endDate      DateTime?
  grade        String?
  description  String?   @db.Text
}

model Certification {
  id           String   @id @default(cuid())
  title        String
  issuer       String
  issueDate    String // Keeping as string per your request (e.g., "Jan 2024")
  imageUrl     String? // For the certificate badge/icon
  credentialId String?
  link         String? // External link to verify
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Technique {
  id          String       @id @default(cuid())
  name        String       @unique
  icon        String?
  projects    Project[]
  experiences Experience[]
}

// -----------------------------------------
// 5. UTILITIES & MESSAGES
// -----------------------------------------

model SkillCategory {
  id       String  @id @default(cuid())
  title    String
  icon     String
  order    Int     @default(0)
  isActive Boolean @default(true)
  skills   Skill[]
}

model Skill {
  id         String        @id @default(cuid())
  name       String
  level      Int?
  icon       String?
  categoryId String
  category   SkillCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
}

model SiteConfig {
  id              String   @id @default("config-static")
  siteName        String   @default("DevPortfolio")
  footerText      String
  profileViews    Int      @default(0)
  enableBlog      Boolean  @default(true)
  metaDescription String?
  updatedAt       DateTime @updatedAt
}
